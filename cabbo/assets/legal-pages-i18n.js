class LegalPagesI18n{constructor(){this.currentLanguage=localStorage.getItem("preferredLanguage")||"en",this.translations={},this.loaded=!1,this.init()}async init(){try{await this.loadTranslations(),this.loaded=!0,this.applyTranslations(),this.initLanguageSwitcher(),window.addEventListener("languageChanged",()=>{this.currentLanguage=window.i18n?window.i18n.currentLanguage:"en",localStorage.setItem("preferredLanguage",this.currentLanguage),this.loadTranslations().then(()=>{this.applyTranslations()})})}catch(e){}}async loadTranslations(){try{const e=await fetch(`${this.currentLanguage}.json`);this.translations=await e.json()}catch(e){this.currentLanguage="en";const t=await fetch("en.json");this.translations=await t.json()}}get(e,t=""){const i=e.split(".");let o=this.translations;for(const e of i){if(!o||"object"!=typeof o||!(e in o))return t;o=o[e]}return o||t}applyTranslations(){const e=this.getPageType();e&&(this.updatePageMeta(e),this.updateNavigation(),this.updateMainContent(e))}getPageType(){const e=window.location.pathname;return e.includes("privacy-policy")?"privacyPolicy":e.includes("terms-of-service")?"termsOfService":e.includes("cookie-policy")?"cookiePolicy":null}updatePageMeta(e){const t=this.get(`legalPages.${e}.title`,"Legal Page"),i=this.get(`legalPages.${e}.description`,"");document.title=`${t} - Cabbo: AI-Powered Agricultural Decision Support System`;const o=document.querySelector('meta[name="description"]');o&&o.setAttribute("content",i),document.documentElement.lang=this.currentLanguage}updateNavigation(){}updateMainContent(e){this.updateDataI18nElements();const t=document.querySelector(".prose p:first-of-type");if(t){const i=this.get(`legalPages.${e}.description`,"");i&&(t.innerHTML=i)}this.updateSections(e),"privacyPolicy"===e&&this.updatePrivacyPolicyYourRights()}updateSections(e){if("cookiePolicy"===e)this.updateCookiePolicySections();else{const t=this.get(`legalPages.${e}.sections`,{});document.querySelectorAll("h2").forEach((i,o)=>{const n=Object.keys(t)[o];if(n&&t[n]){const o=t[n],s=this.get(`legalPages.${e}.sections.${n}.title`,"");if(i.textContent=s,o.description){const e=i.nextElementSibling;e&&"P"===e.tagName&&(e.textContent=o.description)}o.items&&this.updateSectionItems(i,o.items)}})}}updateCookiePolicySections(){document.querySelectorAll(".prose p").forEach(e=>{"Cookies can be:"===e.textContent.trim()&&(e.textContent=this.get("legalPages.cookiePolicy.sections.whatAreCookies.additionalInfo","I cookie possono essere:"))});const e=document.querySelectorAll("h2"),t=["legalPages.cookiePolicy.sections.whatAreCookies.title","legalPages.cookiePolicy.sections.typesOfCookies.title","legalPages.cookiePolicy.sections.legalBasis.title","legalPages.cookiePolicy.sections.cookieTable.title","legalPages.cookiePolicy.sections.cookieManagement.title","legalPages.cookiePolicy.sections.updates.title"];e.forEach((e,i)=>{t[i]&&(e.textContent=this.get(t[i],e.textContent))});document.querySelectorAll("h3").forEach(e=>{const t=e.textContent.trim();t.includes("a)")||t.includes("Strictly Necessary")?(e.textContent=this.get("legalPages.cookiePolicy.sections.typesOfCookies.strictlyNecessary.title","a) Strictly Necessary Cookies"),this.updateCookieSubsectionItems(e,"legalPages.cookiePolicy.sections.typesOfCookies.strictlyNecessary.items")):t.includes("b)")||t.includes("Performance")?(e.textContent=this.get("legalPages.cookiePolicy.sections.typesOfCookies.performanceAnalytics.title","b) Performance and Analytics Cookies"),this.updateCookieSubsectionItems(e,"legalPages.cookiePolicy.sections.typesOfCookies.performanceAnalytics.items")):(t.includes("c)")||t.includes("Marketing"))&&(e.textContent=this.get("legalPages.cookiePolicy.sections.typesOfCookies.marketingProfiling.title","c) Marketing and Profiling Cookies"),this.updateCookieSubsectionItems(e,"legalPages.cookiePolicy.sections.typesOfCookies.marketingProfiling.items"))}),this.updateCookieTableHeaders();const i=this.findSectionByTitle("3. Base Legale per il Trattamento")||this.findSectionByTitle("3. Legal Basis for Processing");i&&this.updateSectionItems(i,this.get("legalPages.cookiePolicy.sections.legalBasis.items",[]));const o=this.findSectionByTitle("5. Gestione dei Cookie")||this.findSectionByTitle("5. Cookie Management");if(o){let e=o.nextElementSibling,t=0;for(;e&&"H2"!==e.tagName;)"P"!==e.tagName||e.querySelector("ul")||(0===t?e.textContent=this.get("legalPages.cookiePolicy.sections.cookieManagement.description",""):1===t?e.textContent=this.get("legalPages.cookiePolicy.sections.cookieManagement.browserSettings",""):2===t&&(e.textContent=this.get("legalPages.cookiePolicy.sections.cookieManagement.note","")),t++),e=e.nextElementSibling;this.updateSectionItems(o,this.get("legalPages.cookiePolicy.sections.cookieManagement.items",[]))}const n=this.findSectionByTitle("6. Aggiornamenti")||this.findSectionByTitle("6. Updates to This Policy");if(n){let e=n.nextElementSibling;for(;e&&"H2"!==e.tagName;){if("P"===e.tagName&&!e.querySelector("ul")){e.textContent=this.get("legalPages.cookiePolicy.sections.updates.description","");break}e=e.nextElementSibling}}}updateCookieSubsectionItems(e,t){const i=this.get(t,[]);i.length>0&&this.updateSectionItems(e,i)}updateCookieTableHeaders(){const e=document.querySelectorAll("table th"),t=this.get("legalPages.cookiePolicy.sections.cookieTable.headers",{});e.length>=5&&(e[0].textContent=t.cookieName||"Cookie Name",e[1].textContent=t.provider||"Provider",e[2].textContent=t.purpose||"Purpose",e[3].textContent=t.duration||"Duration",e[4].textContent=t.type||"Type")}findSectionByTitle(e){const t=document.querySelectorAll("h2");for(const i of t)if(i.textContent.includes(e))return i;return null}updatePrivacyPolicyYourRights(){const e=this.findSectionByTitle("6. I Tuoi Diritti")||this.findSectionByTitle("6. Your Rights");if(e){let t=e.nextElementSibling;for(;t&&"H2"!==t.tagName;){if("P"===t.tagName&&t.textContent.includes("To exercise your rights")||t.textContent.includes("Per esercitare i tuoi diritti")){t.textContent=this.get("legalPages.privacyPolicy.sections.yourRights.contactInfo","")+" ";const e=document.createElement("a");e.href="mailto:support@example.com",e.className="text-brand-green hover:underline",e.textContent="support@example.com",t.appendChild(e),t.appendChild(document.createTextNode("."));break}t=t.nextElementSibling}}}updateSectionItems(e,t){let i=e.nextElementSibling;for(;i&&"UL"!==i.tagName;)i=i.nextElementSibling;if(i&&"UL"===i.tagName){const e=i.querySelectorAll("li");t.forEach((t,i)=>{e[i]&&(e[i].innerHTML=t)})}}updateContactSection(){}updateDataI18nElements(){document.querySelectorAll("[data-i18n]").forEach(e=>{const t=e.getAttribute("data-i18n");t&&(e.textContent=this.get(t))})}initLanguageSwitcher(){const e=document.getElementById("language-switcher"),t=document.getElementById("language-dropdown"),i=document.getElementById("current-language"),o=document.querySelectorAll(".language-option");if(!e||!t)return;let n=!1;const s=()=>{const e={en:"EN",it:"IT"};i&&(i.textContent=e[this.currentLanguage]||"EN")},a=()=>{n=!n,n?t.classList.remove("hidden"):t.classList.add("hidden")},c=()=>{n=!1,t.classList.add("hidden")};e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),a()});const l=i=>{e.contains(i.target)||t.contains(i.target)||c()},r=e=>{"Escape"===e.key&&c()};document.addEventListener("click",l),document.addEventListener("keydown",r),o.forEach(e=>{e.addEventListener("click",async t=>{t.preventDefault();const i=e.getAttribute("data-lang");if(i&&i!==this.currentLanguage){this.showLoadingScreen(),this.currentLanguage=i,localStorage.setItem("preferredLanguage",i);try{await this.loadTranslations(),this.applyTranslations(),s(),c()}catch(e){}finally{setTimeout(()=>{this.hideLoadingScreen()},500)}}})}),s()}}document.addEventListener("DOMContentLoaded",()=>{const e=()=>{window.i18n&&window.i18n.loaded?window.legalPagesI18n=new LegalPagesI18n:setTimeout(e,100)};e()});